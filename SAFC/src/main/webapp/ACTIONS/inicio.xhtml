
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=2.0, minimum-scale=1.0, user-scalable=yes" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css"
		href="/SAFC/BOOTSTRAP/bootstrap.css" />
</h:head>

<body>
	<ui:composition template="/TEMPLATE/template.xhtml">
		<ui:define name="content">
			<script type="text/javascript">
				function mostrarPanelProd(a, b, c) {
					document.getElementsByClassName("oculto")[0].style.display = '';
					document.getElementsByClassName("oculto")[1].style.display = '';
					document.getElementsByClassName("oculto")[2].style.display = '';

				}
				function limpiarForm() {
					document.getElementById("insertClient").reset();
				}
			</script>

			<h:form id="insertClient">
				<p:dialog header="Insercion de Clientes" widgetVar="insertClient"
					modal="true" position="center" width="500">
					<p:messages id="mess" />
					<h:panelGrid columns="2" styleClass="table table-bordered">
						<h:outputLabel value="Cedula*:" for="cedula" />
						<p:inputText id="cedula" styleClass="form-control"
							value="#{clienteBean.cliente.cedula}" required="true"
							requiredMessage="Cedula es obligatorio" label="cedula">
						</p:inputText>

						<h:outputLabel value="Nombres*:" for="nombres" />
						<p:inputText id="nombres" styleClass="form-control"
							value="#{clienteBean.cliente.nombre}" required="true"
							requiredMessage="Nombre es obligatorio" label="nombres" />
						<h:outputLabel value="Apellidos:" for="apellidos" />
						<p:inputText id="apellidos" styleClass="form-control"
							value="#{clienteBean.cliente.apellido}" />
						<h:outputLabel value="Correo:" for="correo" />
						<p:inputText id="correo" styleClass="form-control"
							value="#{clienteBean.cliente.correo}" />
						<h:outputLabel value="Telefono:" for="telefono" />
						<p:inputText id="telefono" styleClass="form-control"
							value="#{clienteBean.cliente.telefono}" />
						<!-- Boton para generar la accion -->
						<p:commandButton id="botonInsertar" value="Insertar"
							oncomplete="limpiarForm()" action="#{clienteBean.addCliente}"
							update="mess,formHeader:tablaClienteComprador" ajax="true">
						</p:commandButton>
					</h:panelGrid>
				</p:dialog>
			</h:form>

			<h:form id="searchClients">
				<p:dialog header="Consulta de clientes" widgetVar="searchCl"
					modal="true" position="center">
					<p:dataTable var="listClient" value="#{clienteBean.clientes}"
						reflow="true" rows="5" widgetVar="clienteTable" paginator="true"
						emptyMessage="No hay clientes que coincidan con la busqueda"
						filteredValue="#{clienteBean.clientesFilter}" id="tablaClientes">
						<f:facet name="header">
							<p:outputPanel>
								<h:outputText value="Busqueda de clientes:" />
								<p:inputText id="globalFilter"
									onkeyup="PF('clienteTable').filter()" style="width:150px"
									placeholder="Ingrese palabra" />
							</p:outputPanel>
						</f:facet>
						<!--  <p:column headerText="Id">
						<h:outputText value="#{listClient.id}" />
					</p:column>-->

						<p:column filterBy="#{listClient.cedula}" headerText="Cedula">
							<h:outputText value="#{listClient.cedula}" />
						</p:column>

						<p:column headerText="Nombres" filterBy="#{listClient.nombres}">
							<h:outputText value="#{listClient.nombres}" />
						</p:column>

						<p:column headerText="Apellidos"
							filterBy="#{listClient.apellidos}">
							<h:outputText value="#{listClient.apellidos}" />
						</p:column>

						<p:column headerText="Dirección" filterBy="#{listClient.correo}">
							<h:outputText value="#{listClient.correo}" />
						</p:column>

						<p:column headerText="Telefono" filterBy="#{listClient.telefono}">
							<h:outputText value="#{listClient.telefono}" />
						</p:column>
						<p:column headerText="Adicionar"
							style="width:100px;text-align: center">
							<p:commandButton icon="ui-icon-search" title="Seleccion"
								ajax="true" oncomplete="PF('searchCl').hide()"
								update=":formHeader:tablaClienteComprador"
								actionListener="#{clienteBean.seleccionarCliente(listClient)}">
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</p:dialog>
			</h:form>

			<h:form id="searchProd">
				<p:dialog header="Consulta de Productos" modal="true"
					widgetVar="searchProductos">
					<p:dataTable var="listProductos"
						value="#{facturacionBean.productosGenericos}" reflow="true"
						rows="5" widgetVar="productosTable" paginator="true"
						emptyMessage="No hay productos que coincidan con la busqueda"
						filteredValue="#{facturacionBean.productosFilter}"
						id="tablaProductos">
						<p:column filterBy="#{listProductos.codigo}" headerText="Código">
							<h:outputText value="#{listProductos.codigo}" />
						</p:column>
						<p:column filterBy="#{listProductos.nombre}" headerText="Nombre:">
							<h:outputText value="#{listProductos.nombre}" />
						</p:column>
						<p:column filterBy="#{listProductos.precio}" headerText="Precio:">
							<h:outputText value="#{listProductos.precio}">
								<f:convertNumber pattern="#,##0.00"></f:convertNumber>
							</h:outputText>
						</p:column>
						<p:column headerText="Adicionar"
							style="width:100px;text-align: center">
							<p:commandButton icon="ui-icon-search" title="Seleccion"
								ajax="true" oncomplete="PF('searchProductos').hide()"
								update=":formInicio:listFact,formHeader:total,:viewPrice:totalSum"
								actionListener="#{facturacionBean.seleccionarProductoGenerico(listProductos)}">
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</p:dialog>
			</h:form>

			<br />
			<h:form id="formHeader">
				<p:growl id="messages" sticky="true" showDetail="true" life="3000" />
				<div class="row">
					<div class="col-md-3 col-sm-12 col-xs-12">
						<p:dock position="top" itemWidth="40" maxWidth="45">
							<p:menuitem title="inserta clientes" value="Insertar Clientes"
								icon="/resources/images/clientes.png"
								onclick="PF('insertClient').show();" />
							<p:menuitem value="Consultar Clientes"
								icon="/resources/images/searchClient.png"
								onclick="PF('searchCl').show();"
								actionListener="#{clienteBean.buscaClientes}"
								update=":searchClients:tablaClientes" />
							<p:menuitem value="Consultar Productos"
								icon="/resources/images/product.png"
								onclick="PF('searchProductos').show();"
								action="#{facturacionBean.buscaProductosGenericos}"
								update=":searchProd:tablaProductos" />
						</p:dock>
					</div>
					<div class="col-md-7 col-sm-12 col-xs-12">
						<h:panelGroup layout="block" id="tablaClienteComprador"
							styleClass="panel">
							<div
								class="col-md-12 col-xs-12 col-sm-12 alert-success text-center"
								style="padding: 2px;">
								<h4>DATOS CLIENTE</h4>
							</div>
							<div class="col-md-4 col-xs-12 col-sm-12">
								<div class="form-group">
									<p:commandLink ajax="true"
										update="formHeader:tablaClienteComprador"
										actionListener="#{clienteBean.genericClient}">
										<p:graphicImage library="images" name="user.png" width="20"
											height="20" />
									</p:commandLink>
									<p:outputLabel value="Cedula:" />
									<p:outputLabel value="#{clienteBean.cliente.cedula}"
										styleClass="form-control" />
								</div>
							</div>
							<div class="col-md-4 col-xs-12 col-sm-12">
								<div class="form-group">
									<p:outputLabel value="Nombres:" />
									<p:outputLabel value="#{clienteBean.cliente.nombre}"
										styleClass="form-control" />
								</div>
							</div>
							<div class="col-md-4 col-xs-12 col-sm-12">
								<div class="form-group">
									<p:outputLabel value="Telefono:" />
									<p:outputLabel value="#{clienteBean.cliente.telefono}"
										styleClass="form-control" />
								</div>
							</div>
						</h:panelGroup>
					</div>
					<div class="col-md-2 col-sm-12 col-xs-12">
						<p:panel style="text-align:center">
							<h:outputText value="#{facturacionBean.total}" id="total"
								style="font-size:38px;font-weight: bold;">
								<f:convertNumber pattern="#,##0.00"></f:convertNumber>
							</h:outputText>
						</p:panel>
					</div>
				</div>
			</h:form>
			<p:messages id="messages" showDetail="true" autoUpdate="true"
				closable="true" />
			<h:form id="formInicio">
				<p:remoteCommand name="test"
					actionListener="#{facturacionBean.searchProdId}" update="product"
					oncomplete="mostrarPanelProd();"
					onsuccess="document.getElementById('formInicio:cantidadProductos').focus(); " />
				<p:remoteCommand name="addProdFac"
					actionListener="#{facturacionBean.addProductFact}"
					update="listFact,formHeader:total,viewPrice:totalSum" />
				<div class="col-md-6 col-sm-12 col-xs-12">

					<div class="row">
						<div class="col-md-12 col-sm-12 col-xs-12">
							<p:dataGrid var="panelRec" columns="6" rows="2" layout="grid"
								value="#{clienteBean.recetas}">
								<f:facet name="header">Platos(Recetas)</f:facet>
								<p:panel header="#{panelRec.codigo}" style="text-align:center">
									<p:commandLink
										actionListener="#{facturacionBean.addProductPanel(panelRec)}"
										ajax="true"
										update="formInicio:listFact,formHeader:total,viewPrice:totalSum">
										<p:graphicImage library="images/products"
											name="#{panelRec.nombre}.#{panelRec.extension}" width="50"
											height="50" />
										<br />
										<p:outputLabel value="#{panelRec.nombre}"
											style="font-size:8px" />
									</p:commandLink>
								</p:panel>
							</p:dataGrid>
							<br />
							<p:dataGrid var="panelProd" columns="6" rows="2" layout="grid"
								style="width:100%" value="#{clienteBean.productos}">
								<f:facet name="header">
									Productos 
								</f:facet>
								<p:panel header="#{panelProd.codigo}" style="text-align:center">
									<h:panelGrid columns="1">
										<p:commandLink
											actionListener="#{facturacionBean.addProductPanel(panelProd)}"
											ajax="true"
											update="formInicio:listFact,formHeader:total,:viewPrice:totalSum">
											<p:graphicImage library="images/products"
												name="#{panelProd.nombre}.#{panelProd.extension}" width="50"
												height="50" />
											<br />
											<p:outputLabel value="#{panelProd.nombre}"
												style="font-size:8px" />

										</p:commandLink>
									</h:panelGrid>
								</p:panel>
							</p:dataGrid>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-sm-12 col-xs-12">
					<h:panelGroup layout="block" id="product" styleClass="panel">
						<div class="col-md-12 col-xs-12 col-sm-12 alert-info text-center"
							style="padding: 2px;">
							<h4>Busqueda de Productos</h4>
						</div>
						<div class="col-md-6 col-xs-12 col-sm-12">
							<div class="form-group">
								<p:outputLabel value="Codigo:" />
								<p:inputText value="#{facturacionBean.codigoAdd}"
									styleClass="form-control" onkeyup=""
									onkeypress="if (event.keyCode == 13){test(); return false;}" />
							</div>
						</div>
						<div class="col-md-6 col-xs-12 col-sm-12">
							<div class="form-group">
								<p:outputLabel value="Cantidad:" />
								<p:inputText value="#{facturacionBean.cantidad}"
									id="cantidadProductos" styleClass="form-control"
									onkeypress="if (event.keyCode == 13){addProdFac(); return false;}">
								</p:inputText>
							</div>
						</div>
						<div class="col-md-2 col-xs-12 col-sm-12 oculto"
							style="display: none;">
							<div class="form-group">
								<p:outputLabel value="#{facturacionBean.product.code}" />

							</div>
						</div>
						<div class="col-md-5 col-xs-12 col-sm-12 oculto"
							style="display: none;">
							<div class="form-group">
								<p:outputLabel value="#{facturacionBean.product.name}" />
							</div>
						</div>
						<div class="col-md-5 col-xs-12 col-sm-12 oculto"
							style="display: none;">
							<div class="form-group">
								<p:outputLabel value="#{facturacionBean.product.price}" />
							</div>
						</div>
					</h:panelGroup>
					<p:panel header="Factura">
						<p:commandLink ajax="true"
							update="formHeader:tablaClienteComprador"
							actionListener="#{facturacionBean.viewTotalPrice}">
							<p:graphicImage library="images" name="bill.png" width="40"
								height="40" />
						</p:commandLink>
						<p:spacer width="300" height="0" />
						<p:spacer width="100" height="0" />
						<p:commandLink actionListener="#{facturacionBean.resetValuesBill}"
							ajax="true"
							update="formInicio:listFact,formHeader:total,viewPrice:totalSum">
							<p:graphicImage library="images" name="nobill.png" width="40"
								height="40" />
						</p:commandLink>
						<p:commandLink
							actionListener="#{facturacionBean.resetValuesClient}" ajax="true"
							update="formHeader:tablaClienteComprador">
							<p:graphicImage library="images" name="noclient.png" width="40"
								height="40" />
						</p:commandLink>
						<p:dataTable var="factura" style="pading:0px;" id="listFact"
							value="#{facturacionBean.listProd}">
							<f:facet name="header">
								Lista de Pedidos
							</f:facet>
							<p:column headerText="Cod" sortBy="#{factura.code}" width="10%">
								<h:outputText value="#{factura.code}" />
							</p:column>
							<p:column headerText="Nombre" width="45%">
								<h:outputText value="#{factura.name}" />
							</p:column>
							<p:column headerText="#" width="5%">
								<h:outputText value="#{factura.amount}" />
							</p:column>
							<p:column headerText="Valor" width="20%">
								<h:outputText value="$#{factura.price}" />
							</p:column>
							<p:column headerText="Valor total" width="20%">
								<h:outputText value="$#{factura.totalPrice}" />
							</p:column>
							<p:column headerText="Eliminar" width="10%">

								<p:commandButton icon="ui-icon-closethick" title="Borrar"
									ajax="true"
									update="listFact,formHeader:total,viewPrice:totalSum"
									actionListener="#{facturacionBean.deleteRow(factura)}">
								</p:commandButton>
								<p:commandButton icon="ui-icon-minus" title="Descontar"
									ajax="true"
									update="listFact,formHeader:total,viewPrice:totalSum"
									actionListener="#{facturacionBean.updateRow(factura)}">
								</p:commandButton>

							</p:column>
						</p:dataTable>
					</p:panel>

				</div>
			</h:form>
			<h:form id="viewPrice">
				<p:dialog header="Pago de Factura" widgetVar="viewPrice"
					modal="true" width="500">
					<p:messages id="messagesPagoFactura" />
					<h:panelGrid columns="2" styleClass="table table-bordered">
						<h:outputText value="Valor a pagar:" />
						<h:outputText value="#{facturacionBean.total}" id="totalSum"
							style="font-size:28px;font-weight: bold;">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</h:outputText>
						<h:outputText value="Pago con:" />
						<p:inputText id="priceTotal"
							value="#{facturacionBean.totalCliente}" styleClass="form-control"
							required="true"
							requiredMessage="Es obligatorio el valor que da el cliente"
							style="font-size:18px;" size="30">
							<p:ajax event="keyup" update="totalCambio,messagesPagoFactura"
								listener="#{facturacionBean.getCambio}" />
						</p:inputText>
						<h:outputText value="Cambio: $ " />
						<h:outputText value="#{facturacionBean.totalChange}"
							id="totalCambio" style="font-size:28px;font-weight: bold;">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</h:outputText>
					</h:panelGrid>
					<div class="row">
						<div class="col-md-0 col-sm-0 col-xs-0"></div>
						<div class="col-md-12 col-sm-12 col-xs-12">
							<div class="col-md-4 col-sm-4 col-xs-4">
								<p:commandLink value="Imprimir Factura"
									update="formInicio:listFact,formHeader:tablaClienteComprador,formHeader:total,viewPrice:totalSum"
									actionListener="#{facturacionBean.facturar}" ajax="true"
									onclick="PF('viewPrice').hide();" styleClass="btn btn-primary"
									style="color:white;" />
							</div>
							<div class="col-md-5 col-sm-4 col-xs-4">
								<p:commandLink value="Registrar sin Factura"
									update="formInicio:listFact,formHeader:tablaClienteComprador,formHeader:total,viewPrice:totalSum,viewBill:totResFac,viewBill:tableName,viewBill:totalResEfectivo,viewBill:totalResCambio"
									ajax="true" actionListener="#{facturacionBean.registrar}"
									onclick="PF('viewPrice').hide();" styleClass="btn btn-primary"
									style="color:white;">
								</p:commandLink>
							</div>
							<div class="col-md-3 col-sm-4 col-xs-4">
								<p:commandLink value="Cancelar" type="button"
									onclick="PF('viewPrice').hide();" styleClass="btn btn-default" />
							</div>
						</div>
						<div class="col-md-0 col-sm-0 col-xs-0"></div>
					</div>
				</p:dialog>
			</h:form>
			<h:form id="viewBill">
				<p:dialog header="Resumen Factura" widgetVar="viewBill" modal="true"
					width="500" closable="false">
					<h:panelGrid styleClass="table table-bordered">
						<p:dataTable id="tableName" value="#{facturacionBean.listProd}"
							reflow="true" var="listproduct">
							<p:column headerText="Nombre Producto">
								<p:outputLabel value="#{listproduct.name}" />
							</p:column>
							<p:column headerText="Cantidad">
								<p:outputLabel value="#{listproduct.amount}" />
							</p:column>
							<p:column headerText="Precio total">
								<p:outputLabel value="#{listproduct.totalPrice}" />
							</p:column>
						</p:dataTable>
						<p:outputLabel id="totResFac"
							value="Total :$#{facturacionBean.total}">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</p:outputLabel>
						<p:outputLabel id="totalResEfectivo"
							value="Efectivo:$#{facturacionBean.totalCliente}">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</p:outputLabel>
						<p:outputLabel id="totalResCambio"
							value="Cambio :$#{facturacionBean.totalChange}">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</p:outputLabel>
						<div class="col-md-4 col-sm-4 col-xs-4">
							<p:commandLink value="Aceptar"
								update="formInicio:listFact,formHeader:tablaClienteComprador,formHeader:total,viewPrice:totalSum,viewBill:totResFac,viewBill:tableName,viewBill:totalResEfectivo,viewBill:totalResCambio"
								actionListener="#{facturacionBean.cerrarFacturaProv}"
								ajax="true" onclick="PF('viewBill').hide();"
								styleClass="btn btn-primary" style="color:white;" />
						</div>
					</h:panelGrid>
				</p:dialog>
			</h:form>
		</ui:define>
	</ui:composition>
</body>
</html>