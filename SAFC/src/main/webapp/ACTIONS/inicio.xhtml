
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, minimum-scale=1.0, user-scalable=yes" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css" href="/SAFC/BOOTSTRAP/bootstrap.css" />
</h:head>

<body>
	<ui:composition template="/TEMPLATE/template.xhtml">
		<ui:define name="content">
			<script type="text/javascript">
				function mostrarPanelProd(a, b, c) {
					document.getElementsByClassName("oculto")[0].style.display = '';
					document.getElementsByClassName("oculto")[1].style.display = '';
					document.getElementsByClassName("oculto")[2].style.display = '';

				}
			</script>
			<br />
			<h:form id="formHeader">
				<p:growl id="messages" sticky="true" showDetail="true" life="3000" />
				<div class="row">
					<div class="col-md-3 col-sm-12 col-xs-12">
						<p:dock position="top" itemWidth="40" maxWidth="45">
							<p:menuitem title="inserta clientes" value="Insertar Clientes" icon="/resources/images/clientes.png" onclick="PF('insertClient').show();" />
							<p:menuitem value="Consultar Clientes" icon="/resources/images/searchClient.png" onclick="PF('searchCl').show();"
								actionListener="#{clienteBean.buscaClientes}" update=":searchClients:tablaClientes" />
							<p:menuitem value="Consultar Productos" icon="/resources/images/product.png" onclick="PF('searchProductos').show();"
								action="#{facturacionBean.buscaProductosGenericos}" update=":searchProd:tablaProductos" />
						</p:dock>
					</div>
					<div class="col-md-7 col-sm-12 col-xs-12">
						<h:panelGroup layout="block" id="tablaClienteComprador" styleClass="panel">
							<div class="col-md-12 col-xs-12 col-sm-12 alert-success text-center" style="padding: 2px;">
								<h4>DATOS CLIENTE</h4>
							</div>
							<div class="col-md-4 col-xs-12 col-sm-12">
								<div class="form-group">
									<p:commandLink ajax="true" update="formHeader:tablaClienteComprador" actionListener="#{clienteBean.genericClient}">
										<p:graphicImage library="images" name="user.png" width="20" height="20" />
									</p:commandLink>
									<p:outputLabel value="Cedula:" />
									<p:outputLabel value="#{clienteBean.cliente.cedula}" styleClass="form-control" />
								</div>
							</div>
							<div class="col-md-4 col-xs-12 col-sm-12">
								<div class="form-group">
									<p:outputLabel value="Nombres:" />
									<p:outputLabel value="#{clienteBean.cliente.nombre}" styleClass="form-control" />
								</div>
							</div>
							<div class="col-md-4 col-xs-12 col-sm-12">
								<div class="form-group">
									<p:outputLabel value="Telefono:" />
									<p:outputLabel value="#{clienteBean.cliente.telefono}" styleClass="form-control" />
								</div>
							</div>
						</h:panelGroup>
					</div>
					<div class="col-md-2 col-sm-12 col-xs-12">
						<p:panel style="text-align:center">
							<h:outputText value="#{facturacionBean.total}" id="total" style="font-size:38px;font-weight: bold;">
								<f:convertNumber pattern="#,##0.00"></f:convertNumber>
							</h:outputText>
						</p:panel>
					</div>
				</div>
			</h:form>
			<p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" />
			<h:form id="formInicio">
				<p:remoteCommand name="test" actionListener="#{facturacionBean.searchProdId}" update="product" oncomplete="mostrarPanelProd();"
					onsuccess="document.getElementById('formInicio:cantidadProductos').focus(); " />
				<p:remoteCommand name="addProdFac" actionListener="#{facturacionBean.addProductFact}" update="listFact,formHeader:total,viewPrice:totalSum" />
				<div class="col-md-6 col-sm-12 col-xs-12">

					<div class="row">
						<div class="col-md-12 col-sm-12 col-xs-12">
							<p:dataGrid var="panelRec" columns="7" layout="grid" value="#{clienteBean.recetas}">
								<f:facet name="header">Platos(Recetas)</f:facet>
								<p:panel header="#{panelRec.codigo}" style="text-align:center">
									<p:commandLink actionListener="#{facturacionBean.addProductPanel(panelRec)}" ajax="true"
										update="formInicio:listFact,formHeader:total,viewPrice:totalSum">
										<p:graphicImage library="images/products" name="#{panelRec.nombre}.#{panelRec.extension}" width="50" height="50" />
										<p:outputLabel value="#{panelRec.nombre}" style="font-size:8px" />
									</p:commandLink>
								</p:panel>
							</p:dataGrid>
							<br />
							<p:dataGrid var="panelProd" columns="7" layout="grid" style="width:100%" value="#{clienteBean.productos}">
								<f:facet name="header">
									Productos 
								</f:facet>
								<p:panel header="#{panelProd.codigo}" style="text-align:center">
									<h:panelGrid columns="1">
										<p:commandLink actionListener="#{facturacionBean.addProductPanel(panelProd)}" ajax="true"
											update="formInicio:listFact,formHeader:total,:viewPrice:totalSum">
											<p:graphicImage library="images/products" name="#{panelProd.nombre}.#{panelProd.extension}" width="50" height="50" />
											<p:outputLabel value="#{panelProd.nombre}" style="font-size:8px" />
										</p:commandLink>
									</h:panelGrid>
								</p:panel>
							</p:dataGrid>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-sm-12 col-xs-12">
					<h:panelGroup layout="block" id="product" styleClass="panel">
						<div class="col-md-12 col-xs-12 col-sm-12 alert-info text-center" style="padding: 2px;">
							<h4>Busqueda de Productos</h4>
						</div>
						<div class="col-md-6 col-xs-12 col-sm-12">
							<div class="form-group">
								<p:outputLabel value="Codigo:" />
								<p:inputText value="#{facturacionBean.codigoAdd}" styleClass="form-control" onkeyup=""
									onkeypress="if (event.keyCode == 13){test(); return false;}" />
							</div>
						</div>
						<div class="col-md-6 col-xs-12 col-sm-12">
							<div class="form-group">
								<p:outputLabel value="Cantidad:" />
								<p:inputText value="#{facturacionBean.cantidad}" id="cantidadProductos" styleClass="form-control"
									onkeypress="if (event.keyCode == 13){addProdFac(); return false;}">
								</p:inputText>
							</div>
						</div>
						<div class="col-md-2 col-xs-12 col-sm-12 oculto" style="display: none;">
							<div class="form-group">
								<p:outputLabel value="#{facturacionBean.product.code}" />

							</div>
						</div>
						<div class="col-md-5 col-xs-12 col-sm-12 oculto" style="display: none;">
							<div class="form-group">
								<p:outputLabel value="#{facturacionBean.product.name}" />
							</div>
						</div>
						<div class="col-md-5 col-xs-12 col-sm-12 oculto" style="display: none;">
							<div class="form-group">
								<p:outputLabel value="#{facturacionBean.product.price}" />
							</div>
						</div>
					</h:panelGroup>
					<p:panel header="Factura">
						<p:commandLink ajax="true" update="formHeader:tablaClienteComprador">
							<p:graphicImage library="images" onclick="PF('viewPrice').show();" name="bill.png" width="40" height="40" />
						</p:commandLink>
						<p:spacer width="300" height="0" />
						<p:spacer width="100" height="0" />
						<p:commandLink actionListener="#{facturacionBean.resetValuesBill}" ajax="true" update="formInicio:listFact,formHeader:total,viewPrice:totalSum">
							<p:graphicImage library="images" name="nobill.png" width="40" height="40" />
						</p:commandLink>
						<p:commandLink actionListener="#{facturacionBean.resetValuesClient}" ajax="true" update="formHeader:tablaClienteComprador">
							<p:graphicImage library="images" name="noclient.png" width="40" height="40" />
						</p:commandLink>
						<p:dataTable var="factura" style="pading:0px;" id="listFact" value="#{facturacionBean.listProd}">
							<f:facet name="header">
								Lista de Pedidos
							</f:facet>
							<p:column headerText="Cod" sortBy="#{factura.code}" width="10%">
								<h:outputText value="#{factura.code}" />
							</p:column>
							<p:column headerText="Nombre" width="45%">
								<h:outputText value="#{factura.name}" />
							</p:column>
							<p:column headerText="#" width="5%">
								<h:outputText value="#{factura.amount}" />
							</p:column>
							<p:column headerText="Valor" width="20%">
								<h:outputText value="$#{factura.price}" />
							</p:column>
							<p:column headerText="Valor total" width="20%">
								<h:outputText value="$#{factura.totalPrice}" />
							</p:column>
							<p:column headerText="Eliminar" width="10%">

								<p:commandButton icon="ui-icon-closethick" title="Borrar" ajax="true" update="listFact,formHeader:total,viewPrice:totalSum"
									actionListener="#{facturacionBean.deleteRow(factura)}">
								</p:commandButton>
								<p:commandButton icon="ui-icon-minus" title="Descontar" ajax="true" update="listFact,formHeader:total,viewPrice:totalSum"
									actionListener="#{facturacionBean.updateRow(factura)}">
								</p:commandButton>

							</p:column>
						</p:dataTable>
					</p:panel>

				</div>
			</h:form>
			<h:form id="viewPrice">
				<p:dialog header="Pago de Factura" widgetVar="viewPrice" modal="true" width="500">
					<p:messages id="messagesPagoFactura" />
					<h:panelGrid columns="2" styleClass="table table-bordered">
						<h:outputText value="Valor a pagar:" />
						<h:outputText value="#{facturacionBean.total}" id="totalSum" style="font-size:28px;font-weight: bold;">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</h:outputText>
						<h:outputText value="Pago con:" />
						<p:inputText id="priceTotal" value="#{facturacionBean.totalCliente}" styleClass="form-control" required="true"
							requiredMessage="Es obligatorio el valor que da el cliente" style="font-size:18px;" size="30">
							<p:ajax event="keyup" update="totalCambio,messagesPagoFactura" listener="#{facturacionBean.getCambio}" />
						</p:inputText>
						<h:outputText value="Cambio: $ " />
						<h:outputText value="#{facturacionBean.totalChange}" id="totalCambio" style="font-size:28px;font-weight: bold;">
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</h:outputText>
					</h:panelGrid>
					<div class="row">
						<div class="col-md-0 col-sm-0 col-xs-0"></div>
						<div class="col-md-12 col-sm-12 col-xs-12">
							<div class="col-md-4 col-sm-4 col-xs-4">
								<p:commandLink value="Imprimir Factura"
									update="formInicio:listFact,formHeader:tablaClienteComprador,formHeader:total,viewPrice:totalSum"
									actionListener="#{facturacionBean.facturar}" ajax="true" onclick="PF('viewPrice').hide();" styleClass="btn btn-primary" style="color:white;" />
							</div>							
							<div class="col-md-5 col-sm-4 col-xs-4">
								<p:commandLink value="Registrar sin Factura" update="formInicio:listFact,formHeader:tablaClienteComprador,formHeader:total,viewPrice:totalSum"
									ajax="true" actionListener="#{facturacionBean.registrar}" onclick="PF('viewPrice').hide();" styleClass="btn btn-primary" style="color:white;">
								</p:commandLink>
							</div>
							<div class="col-md-3 col-sm-4 col-xs-4">
								<p:commandLink value="Cancelar" type="button" onclick="PF('viewPrice').hide();" styleClass="btn btn-default"/>
							</div>
						</div>
						<div class="col-md-0 col-sm-0 col-xs-0"></div>
					</div>
				</p:dialog>
			</h:form>
		</ui:define>
	</ui:composition>
</body>
</html>